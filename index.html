<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Palette Designer</title>
    <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.4.0/css/all.min.css">
    <style>
        /* ... (CSS remains unchanged) ... */
    </style>
</head>
<body>
    <div class="container">
        <header>
            <h1>Palette Designer</h1>
            <p class="subtitle">Create, customize and save your own color palettes. Click the buttons to select new colors, then save your design.</p>
        </header>
        
        <div class="content">
            <div class="palette-section">
                <div class="section-title">
                    <i class="fas fa-palette"></i>
                    <h2>Palette Editor</h2>
                </div>
                
                <div class="color-blocks">
                    <!-- Updated initial colors to be less bright -->
                    <div class="color-item">
                        <div class="color-block" style="background-color: #726998;" id="color1">
                            <span class="color-code" id="code1">#726998</span>
                        </div>
                        <div class="color-info">
                            <div class="color-code" id="code1-text">#726998</div>
                            <button class="btn" onclick="openColorPicker(0)">
                                <i class="fas fa-eye-dropper"></i> Pick Color
                            </button>
                        </div>
                    </div>
                    
                    <div class="color-item">
                        <div class="color-block" style="background-color: #6a9e87;" id="color2">
                            <span class="color-code" id="code2">#6A9E87</span>
                        </div>
                        <div class="color-info">
                            <div class="color-code" id="code2-text">#6A9E87</div>
                            <button class="btn" onclick="openColorPicker(1)">
                                <i class="fas fa-eye-dropper"></i> Pick Color
                            </button>
                        </div>
                    </div>
                    
                    <div class="color-item">
                        <div class="color-block" style="background-color: #a89a70;" id="color3">
                            <span class="color-code" id="code3">#A89A70</span>
                        </div>
                        <div class="color-info">
                            <div class="color-code" id="code3-text">#A89A70</div>
                            <button class="btn" onclick="openColorPicker(2)">
                                <i class="fas fa-eye-dropper"></i> Pick Color
                            </button>
                        </div>
                    </div>
                    
                    <div class="color-item">
                        <div class="color-block" style="background-color: #8d6ba5;" id="color4">
                            <span class="color-code" id="code4">#8D6BA5</span>
                        </div>
                        <div class="color-info">
                            <div class="color-code" id="code4-text">#8D6BA5</div>
                            <button class="btn" onclick="openColorPicker(3)">
                                <i class="fas fa-eye-dropper"></i> Pick Color
                            </button>
                        </div>
                    </div>
                    
                    <div class="color-item">
                        <div class="color-block" style="background-color: #6a8ba8;" id="color5">
                            <span class="color-code" id="code5">#6A8BA8</span>
                        </div>
                        <div class="color-info">
                            <div class="color-code" id="code5-text">#6A8BA8</div>
                            <button class="btn" onclick="openColorPicker(4)">
                                <i class="fas fa-eye-dropper"></i> Pick Color
                            </button>
                        </div>
                    </div>
                </div>
            </div>
            
            <div class="palette-section">
                <div class="section-title">
                    <i class="fas fa-swatchbook"></i>
                    <h2>Saved Palettes</h2>
                </div>
                
                <div class="palettes-container" id="saved-palettes">
                    <!-- Updated example palette to match new colors -->
                    <div class="saved-palette" onclick="loadPalette(0)">
                        <div class="palette-actions">
                            <button class="action-btn copy" onclick="copyPalette(event, 0)">
                                <i class="fas fa-copy"></i>
                            </button>
                            <button class="action-btn delete" onclick="deletePalette(event, 0)">
                                <i class="fas fa-trash"></i>
                            </button>
                        </div>
                        <div class="palette-colors">
                            <div class="palette-color" style="background-color: #726998;"></div>
                            <div class="palette-color" style="background-color: #6a9e87;"></div>
                            <div class="palette-color" style="background-color: #a89a70;"></div>
                            <div class="palette-color" style="background-color: #8d6ba5;"></div>
                            <div class="palette-color" style="background-color: #6a8ba8;"></div>
                        </div>
                        <div class="palette-name">Example Palette</div>
                    </div>
                </div>
            </div>
        </div>
        
        <div class="save-section">
            <button class="btn btn-secondary" onclick="exportPalette()">
                <i class="fas fa-file-export"></i> Export Palette
            </button>
            <button class="btn" id="save-palette" onclick="savePalette()">
                <i class="fas fa-save"></i> Save Current Palette
            </button>
        </div>
    </div>
    
    <!-- Color Picker Modal -->
    <div class="color-picker-modal" id="colorPickerModal">
        <div class="color-picker-container">
            <div class="picker-header">
                <h2>Color Picker</h2>
            </div>
            
            <div class="picker-body">
                <div class="color-preview" id="colorPreview">
                    <span id="currentColor">#726998</span>
                </div>
                
                <div class="color-sliders">
                    <div class="slider-container">
                        <span class="slider-label">Hue</span>
                        <input type="range" min="0" max="360" value="0" id="hueSlider">
                    </div>
                    
                    <div class="slider-container">
                        <span class="slider-label">Saturation</span>
                        <input type="range" min="0" max="100" value="50" id="saturationSlider"> <!-- Changed default to 50 -->
                    </div>
                    
                    <div class="slider-container">
                        <span class="slider-label">Lightness</span>
                        <input type="range" min="0" max="100" value="50" id="lightnessSlider"> <!-- Changed default to 50 -->
                    </div>
                </div>
                
                <div class="color-inputs">
                    <div class="input-group">
                        <label for="hexInput">HEX</label>
                        <input type="text" id="hexInput" value="#726998">
                    </div>
                    
                    <div class="input-group">
                        <label for="rgbInput">RGB</label>
                        <input type="text" id="rgbInput" value="rgb(114, 105, 152)">
                    </div>
                    
                    <div class="input-group">
                        <label for="hslInput">HSL</label>
                        <input type="text" id="hslInput" value="hsl(251, 18%, 50%)">
                    </div>
                </div>
            </div>
            
            <div class="modal-actions">
                <button class="btn btn-cancel" onclick="closeColorPicker()">
                    <i class="fas fa-times"></i> Cancel
                </button>
                <button class="btn" onclick="applyColor()">
                    <i class="fas fa-check"></i> Apply Color
                </button>
            </div>
        </div>
    </div>
    
    <div class="notification" id="notification">
        <i class="fas fa-check-circle"></i>
        <span>Palette copied to clipboard!</span>
    </div>
    
    <script>
        // Global variables
        let currentColorIndex = -1;
        let currentHue = 0;
        let currentSaturation = 50;  // Changed default to 50%
        let currentLightness = 50;    // Changed default to 50%
        let savedPalettes = [];
        let lastValidHex = '#726998'; // Track last valid hex
        
        // Initialize the color picker
        function initColorPicker() {
            const hueSlider = document.getElementById('hueSlider');
            const saturationSlider = document.getElementById('saturationSlider');
            const lightnessSlider = document.getElementById('lightnessSlider');
            const hexInput = document.getElementById('hexInput');
            const rgbInput = document.getElementById('rgbInput');
            const hslInput = document.getElementById('hslInput');
            
            // Update color based on slider changes
            hueSlider.addEventListener('input', updateColorFromSliders);
            saturationSlider.addEventListener('input', updateColorFromSliders);
            lightnessSlider.addEventListener('input', updateColorFromSliders);
            
            // Update from HEX input
            hexInput.addEventListener('input', function() {
                const hex = this.value;
                if (isValidHex(hex)) {
                    lastValidHex = hex.startsWith('#') ? hex : '#' + hex;
                    updateColorFromHex(lastValidHex);
                }
            });
            
            // Revert to last valid hex on blur if invalid
            hexInput.addEventListener('blur', function() {
                if (!isValidHex(this.value)) {
                    this.value = lastValidHex;
                }
            });
            
            // Add example saved palettes
            savedPalettes.push({
                name: "Example Palette",
                colors: ["#726998", "#6A9E87", "#A89A70", "#8D6BA5", "#6A8BA8"]
            });
        }
        
        // Check if hex is valid
        function isValidHex(hex) {
            return /^#?([A-Fa-f0-9]{6}|[A-Fa-f0-9]{3})$/.test(hex);
        }
        
        // Open color picker for a specific color block
        function openColorPicker(index) {
            currentColorIndex = index;
            const colorBlock = document.getElementById(`color${index + 1}`);
            const bgColor = window.getComputedStyle(colorBlock).backgroundColor;
            
            // Convert RGB to HSL
            const rgb = bgColor.match(/\d+/g);
            const hsl = rgbToHsl(parseInt(rgb[0]), parseInt(rgb[1]), parseInt(rgb[2]));
            
            currentHue = Math.round(hsl[0]);
            currentSaturation = Math.round(hsl[1] * 100);
            currentLightness = Math.round(hsl[2] * 100);
            
            // Set last valid hex to current color
            lastValidHex = rgbToHex(parseInt(rgb[0]), parseInt(rgb[1]), parseInt(rgb[2]));
            
            // Update sliders
            document.getElementById('hueSlider').value = currentHue;
            document.getElementById('saturationSlider').value = currentSaturation;
            document.getElementById('lightnessSlider').value = currentLightness;
            
            // Update preview
            updateColorPreview();
            
            // Show modal
            document.getElementById('colorPickerModal').style.display = 'flex';
        }
        
        // Convert RGB to HEX
        function rgbToHex(r, g, b) {
            return `#${((1 << 24) + (r << 16) + (g << 8) + b).toString(16).slice(1).toUpperCase()}`;
        }
        
        // Close color picker
        function closeColorPicker() {
            document.getElementById('colorPickerModal').style.display = 'none';
        }
        
        // Apply selected color to the color block
        function applyColor() {
            if (currentColorIndex === -1) return;
            
            const color = hslToHex(currentHue, currentSaturation, currentLightness);
            const colorBlock = document.getElementById(`color${currentColorIndex + 1}`);
            const colorCode = document.getElementById(`code${currentColorIndex + 1}`);
            const colorCodeText = document.getElementById(`code${currentColorIndex + 1}-text`);
            
            colorBlock.style.backgroundColor = color;
            colorCode.textContent = color;
            colorCodeText.textContent = color;
            
            closeColorPicker();
        }
        
        // Update color preview based on current HSL values
        function updateColorFromSliders() {
            currentHue = parseInt(document.getElementById('hueSlider').value);
            currentSaturation = parseInt(document.getElementById('saturationSlider').value);
            currentLightness = parseInt(document.getElementById('lightnessSlider').value);
            
            updateColorPreview();
        }
        
        // Update color from HEX input
        function updateColorFromHex(hex) {
            // Remove # if present
            hex = hex.replace('#', '');
            
            // Convert HEX to RGB
            let r = 0, g = 0, b = 0;
            
            // 3 digits
            if (hex.length === 3) {
                r = parseInt(hex[0] + hex[0], 16);
                g = parseInt(hex[1] + hex[1], 16);
                b = parseInt(hex[2] + hex[2], 16);
            } 
            // 6 digits
            else if (hex.length === 6) {
                r = parseInt(hex[0] + hex[1], 16);
                g = parseInt(hex[2] + hex[3], 16);
                b = parseInt(hex[4] + hex[5], 16);
            }
            
            // Convert RGB to HSL
            const hsl = rgbToHsl(r, g, b);
            
            currentHue = Math.round(hsl[0]);
            currentSaturation = Math.round(hsl[1] * 100);
            currentLightness = Math.round(hsl[2] * 100);
            
            // Update sliders
            document.getElementById('hueSlider').value = currentHue;
            document.getElementById('saturationSlider').value = currentSaturation;
            document.getElementById('lightnessSlider').value = currentLightness;
            
            updateColorPreview();
        }
        
        // Update the color preview
        function updateColorPreview() {
            const color = `hsl(${currentHue}, ${currentSaturation}%, ${currentLightness}%)`;
            const hex = hslToHex(currentHue, currentSaturation, currentLightness);
            const rgb = hslToRgb(currentHue, currentSaturation, currentLightness);
            
            document.getElementById('colorPreview').style.backgroundColor = color;
            document.getElementById('currentColor').textContent = hex;
            
            // Update last valid hex
            lastValidHex = hex;
            
            // Update input fields
            document.getElementById('hexInput').value = hex;
            document.getElementById('rgbInput').value = `rgb(${rgb[0]}, ${rgb[1]}, ${rgb[2]})`;
            document.getElementById('hslInput').value = `hsl(${currentHue}, ${currentSaturation}%, ${currentLightness}%)`;
        }
        
        // ... (rest of the JavaScript remains the same) ...
    </script>
</body>
</html>
